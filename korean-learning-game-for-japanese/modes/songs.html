<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ­Œã§å­¦ç¿’ - K-POPéŸ“å›½èªãƒã‚¹ã‚¿ãƒ¼</title>
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <style>
        :root {
            --primary: #06b6d4;
            --primary-dark: #0891b2;
            --secondary: #0ea5e9;
            --accent: #67e8f9;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --font-sans: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-sans);
            background: linear-gradient(135deg, #06b6d4 0%, #0ea5e9 100%);
            min-height: 100vh;
            padding: 1rem;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
        .header {
            background: white;
            padding: 1.5rem 2rem;
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-title {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .header-title h1 {
            font-size: 1.75rem;
            color: var(--primary);
        }

        .home-btn {
            padding: 0.5rem 1.5rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.2s;
            text-decoration: none;
            display: inline-block;
        }

        .home-btn:hover {
            transform: scale(1.05);
        }

        /* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
        .nav-tabs {
            background: white;
            padding: 1rem;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .nav-tab {
            padding: 0.75rem 1.5rem;
            background: #f3f4f6;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 0.9rem;
        }

        .nav-tab.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
        }

        .nav-tab:hover:not(.active) {
            background: #e5e7eb;
        }

        /* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ */
        .content-area {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            min-height: 500px;
        }

        .mode-section {
            display: none;
        }

        .mode-section.active {
            display: block;
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* æ­Œé¸æŠç”»é¢ */
        .songs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        .song-card {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            padding: 1.5rem;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .song-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            border-color: var(--primary);
        }

        .song-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: #111827;
        }

        .song-artist {
            font-size: 0.9rem;
            color: #6b7280;
            margin-bottom: 0.5rem;
        }

        .song-level {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            background: var(--primary);
            color: white;
            font-size: 0.75rem;
            border-radius: 0.375rem;
            font-weight: 600;
        }

        /* ç©´åŸ‹ã‚ã‚²ãƒ¼ãƒ ç”»é¢ */
        .game-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .song-info {
            text-align: center;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border-radius: 0.75rem;
        }

        .song-info h2 {
            font-size: 1.75rem;
            margin-bottom: 0.5rem;
            color: var(--primary);
        }

        .song-info p {
            color: #6b7280;
            font-size: 1rem;
        }

        .lyrics-container {
            background: #f9fafb;
            padding: 2rem;
            border-radius: 0.75rem;
            margin-bottom: 2rem;
            line-height: 2;
            font-size: 1.1rem;
        }

        .lyrics-line {
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .blank-input {
            display: inline-block;
            min-width: 100px;
            padding: 0.5rem;
            border: 2px solid #d1d5db;
            border-radius: 0.375rem;
            font-size: 1.1rem;
            transition: all 0.3s;
        }

        .blank-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(6, 182, 212, 0.1);
        }

        .blank-input.correct {
            border-color: var(--success);
            background: #f0fdf4;
        }

        .blank-input.incorrect {
            border-color: var(--error);
            background: #fef2f2;
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .hint-btn {
            background: var(--warning);
            color: white;
            border: none;
            padding: 0.25rem 0.75rem;
            border-radius: 0.375rem;
            cursor: pointer;
            font-size: 0.85rem;
            margin-left: 0.5rem;
        }

        .translation-toggle {
            background: #8b5cf6;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            cursor: pointer;
            margin-bottom: 1rem;
            font-weight: 600;
        }

        .japanese-translation {
            display: none;
            color: #6b7280;
            font-size: 0.95rem;
            margin-top: 0.5rem;
            font-style: italic;
        }

        .japanese-translation.show {
            display: block;
        }

        /* ç™ºéŸ³ã‚¬ã‚¤ãƒ‰ */
        .pronunciation-guide {
            background: #fef3c7;
            border-left: 4px solid var(--warning);
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0.375rem;
        }

        .pronunciation-guide h4 {
            color: #92400e;
            margin-bottom: 0.5rem;
        }

        .pronunciation-tip {
            color: #78350f;
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
        }

        /* ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒœã‚¿ãƒ³ */
        .controls {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
            flex-wrap: wrap;
        }

        .btn {
            padding: 0.75rem 2rem;
            border: none;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* é€²æ—è¡¨ç¤º */
        .progress-container {
            margin-bottom: 2rem;
        }

        .progress-bar {
            background: #e5e7eb;
            height: 12px;
            border-radius: 6px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
            transition: width 0.5s ease;
        }

        .progress-text {
            text-align: center;
            margin-top: 0.5rem;
            color: #6b7280;
            font-weight: 600;
        }

        /* çµ±è¨ˆ */
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }

        .stat-card {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            padding: 1.5rem;
            border-radius: 0.75rem;
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
        }

        .stat-label {
            font-size: 0.85rem;
            color: #6b7280;
            margin-top: 0.25rem;
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 1rem;
            }

            .nav-tabs {
                justify-content: center;
            }

            .lyrics-line {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
        <div class="header">
            <div class="header-title">
                <span style="font-size: 2rem;">ğŸµ</span>
                <h1>æ­Œã§å­¦ç¿’ãƒ¢ãƒ¼ãƒ‰</h1>
            </div>
            <a href="../index.html" class="home-btn">ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</a>
        </div>

        <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚¿ãƒ– -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showMode('select')">æ­Œã‚’é¸ã¶</button>
            <button class="nav-tab" onclick="showMode('fillblank')" id="fillblankTab" disabled>ç©´åŸ‹ã‚ã‚²ãƒ¼ãƒ </button>
            <button class="nav-tab" onclick="showMode('pronunciation')" id="pronunciationTab" disabled>ç™ºéŸ³ç·´ç¿’</button>
            <button class="nav-tab" onclick="showMode('stats')">å­¦ç¿’çµ±è¨ˆ</button>
        </div>

        <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚¨ãƒªã‚¢ -->
        <div class="content-area">
            <!-- æ­Œé¸æŠãƒ¢ãƒ¼ãƒ‰ -->
            <div id="selectMode" class="mode-section active">
                <h2 style="margin-bottom: 2rem; text-align: center; color: #111827;">å­¦ç¿’ã—ãŸã„æ­Œã‚’é¸ã‚“ã§ãã ã•ã„</h2>
                <div class="songs-grid" id="songsGrid">
                    <!-- JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
                </div>
            </div>

            <!-- ç©´åŸ‹ã‚ã‚²ãƒ¼ãƒ ãƒ¢ãƒ¼ãƒ‰ -->
            <div id="fillblankMode" class="mode-section">
                <div class="game-container">
                    <div class="song-info" id="songInfo">
                        <h2 id="currentSongTitle"></h2>
                        <p id="currentSongArtist"></p>
                    </div>

                    <div class="progress-container">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                        </div>
                        <div class="progress-text" id="progressText">0 / 0 æ­£è§£</div>
                    </div>

                    <button class="translation-toggle" onclick="toggleTranslations()">
                        æ—¥æœ¬èªè¨³ã‚’è¡¨ç¤º / éè¡¨ç¤º
                    </button>

                    <div class="lyrics-container" id="lyricsContainer">
                        <!-- JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
                    </div>

                    <div class="controls">
                        <button class="btn btn-secondary" onclick="resetGame()">ãƒªã‚»ãƒƒãƒˆ</button>
                        <button class="btn btn-primary" onclick="checkAnswers()">ç­”ãˆåˆã‚ã›</button>
                        <button class="btn btn-success" onclick="showAllAnswers()">ç­”ãˆã‚’è¦‹ã‚‹</button>
                    </div>
                </div>
            </div>

            <!-- ç™ºéŸ³ç·´ç¿’ãƒ¢ãƒ¼ãƒ‰ -->
            <div id="pronunciationMode" class="mode-section">
                <div class="game-container">
                    <h2 style="text-align: center; margin-bottom: 2rem; color: #111827;">
                        ç™ºéŸ³ã‚¬ã‚¤ãƒ‰ - æ—¥æœ¬äººãŒè‹¦æ‰‹ãªç™ºéŸ³
                    </h2>

                    <div class="pronunciation-guide">
                        <h4>ã“ã®æ­Œã§ç·´ç¿’ã™ã‚‹ç™ºéŸ³</h4>
                        <div id="pronunciationTips">
                            <!-- JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
                        </div>
                    </div>

                    <div class="lyrics-container" id="pronunciationLyrics">
                        <!-- JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
                    </div>

                    <div class="controls">
                        <button class="btn btn-primary" onclick="playPronunciation()">ç™ºéŸ³ã‚’èã</button>
                        <button class="btn btn-secondary" onclick="showMode('fillblank')">ç©´åŸ‹ã‚ã«æˆ»ã‚‹</button>
                    </div>
                </div>
            </div>

            <!-- çµ±è¨ˆãƒ¢ãƒ¼ãƒ‰ -->
            <div id="statsMode" class="mode-section">
                <h2 style="text-align: center; margin-bottom: 2rem; color: #111827;">ã‚ãªãŸã®å­¦ç¿’çµ±è¨ˆ</h2>
                <div class="stats" id="statsContainer">
                    <!-- JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let currentSong = null;
        let songsData = [];
        let correctAnswers = 0;
        let totalBlanks = 0;
        let stats = {
            songsCompleted: 0,
            totalCorrect: 0,
            totalAttempts: 0,
            studyTime: 0
        };

        // åˆæœŸåŒ–
        async function init() {
            loadStats();
            await loadSongsData();
            renderSongsGrid();
            updateStatsDisplay();
        }

        // æ­Œãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
        async function loadSongsData() {
            try {
                const response = await fetch('../data/songs/songs-data.json');
                songsData = await response.json();
            } catch (error) {
                console.error('æ­Œãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                // ãƒ‡ãƒ¢ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨
                songsData = getDemoSongs();
            }
        }

        // ãƒ‡ãƒ¢æ­Œãƒ‡ãƒ¼ã‚¿
        function getDemoSongs() {
            return [
                {
                    id: 1,
                    title: "ì‚¬ë‘í•´ (æ„›ã—ã¦ã‚‹)",
                    artist: "K-POP ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ",
                    level: "åˆç´š",
                    lyrics: [
                        { korean: "ì‚¬ë‘í•´ ë„ˆë¥¼ {{ì‚¬ë‘í•´}}", japanese: "æ„›ã—ã¦ã‚‹ã€å›ã‚’æ„›ã—ã¦ã‚‹", blanks: ["ì‚¬ë‘í•´"] },
                        { korean: "{{ë§¤ì¼}} ìƒê°í•´ ë„ˆë§Œ ìƒê°í•´", japanese: "æ¯æ—¥è€ƒãˆã¦ã‚‹ã€å›ã ã‘ã‚’è€ƒãˆã¦ã‚‹", blanks: ["ë§¤ì¼"] },
                        { korean: "í•¨ê»˜ {{ê±·ê³ }} ì‹¶ì–´", japanese: "ä¸€ç·’ã«æ­©ããŸã„", blanks: ["ê±·ê³ "] }
                    ],
                    pronunciationTips: [
                        { word: "ì‚¬ë‘í•´", tip: "ã€Œã‚µãƒ©ãƒ³ãƒ˜ã€ãƒ‘ãƒƒãƒãƒ ã€Œã…‡ã€ã¯é¼»éŸ³ã§ã™", difficulty: "medium" },
                        { word: "ë§¤ì¼", tip: "ã€Œãƒ¡ã‚¤ãƒ«ã€ã€Œã…ã€ã¨ã€Œã…”ã€ã®é•ã„ã«æ³¨æ„", difficulty: "hard" }
                    ]
                },
                {
                    id: 2,
                    title: "ê¿ˆ (å¤¢)",
                    artist: "ãƒãƒ©ãƒ¼ãƒ‰ã‚·ãƒ³ã‚¬ãƒ¼",
                    level: "ä¸­ç´š",
                    lyrics: [
                        { korean: "{{ê¿ˆ}}ì²˜ëŸ¼ ë‹¤ê°€ì˜¨ ë„ˆ", japanese: "å¤¢ã®ã‚ˆã†ã«è¿‘ã¥ã„ã¦ããŸå›", blanks: ["ê¿ˆ"] },
                        { korean: "ë‚´ {{ë§ˆìŒ}}ì„ ê°€ì ¸ê°„ ë„ˆ", japanese: "ç§ã®å¿ƒã‚’æŒã£ã¦ã„ã£ãŸå›", blanks: ["ë§ˆìŒ"] },
                        { korean: "{{ì˜ì›}}íˆ í•¨ê»˜í•˜ì", japanese: "æ°¸é ã«ä¸€ç·’ã«ã„ã‚ˆã†", blanks: ["ì˜ì›"] }
                    ],
                    pronunciationTips: [
                        { word: "ê¿ˆ", tip: "ã€Œãƒƒã‚¯ãƒ ã€æ¿ƒéŸ³ã€Œã„²ã€ã¯å¼·ãç™ºéŸ³", difficulty: "hard" },
                        { word: "ë§ˆìŒ", tip: "ã€Œãƒã‚¦ãƒ ã€ãƒ‘ãƒƒãƒãƒ ã€Œã…ã€ã¯å”‡ã‚’é–‰ã˜ã‚‹", difficulty: "medium" }
                    ]
                },
                {
                    id: 3,
                    title: "ë´„ë‚  (æ˜¥ã®æ—¥)",
                    artist: "äººæ°—ã‚°ãƒ«ãƒ¼ãƒ—",
                    level: "ä¸­ä¸Šç´š",
                    lyrics: [
                        { korean: "{{ë³´ê³ }} ì‹¶ë‹¤ ì´ë ‡ê²Œ", japanese: "ä¼šã„ãŸã„ã€ã“ã‚“ãªã«", blanks: ["ë³´ê³ "] },
                        { korean: "ë§í•˜ë‹ˆê¹Œ {{ë”}} ë³´ê³  ì‹¶ë‹¤", japanese: "è¨€ã†ã‹ã‚‰ã‚‚ã£ã¨ä¼šã„ãŸã„", blanks: ["ë”"] },
                        { korean: "{{ë´„ë‚ }}ì´ ì˜¬ ë•Œê¹Œì§€", japanese: "æ˜¥ã®æ—¥ãŒæ¥ã‚‹ã¾ã§", blanks: ["ë´„ë‚ "] }
                    ],
                    pronunciationTips: [
                        { word: "ë³´ê³ ", tip: "ã€Œãƒã‚´ã€ã€Œã…—ã€ã¯æ—¥æœ¬èªã®ã€Œã‚ªã€ã‚ˆã‚Šå£ã‚’ä¸¸ã", difficulty: "medium" },
                        { word: "ë´„ë‚ ", tip: "ã€Œãƒãƒ ãƒŠãƒ«ã€ãƒ‘ãƒƒãƒãƒ ã€Œã…ã€ã®å¾Œã®é€£éŸ³åŒ–ã«æ³¨æ„", difficulty: "hard" }
                    ]
                }
            ];
        }

        // æ­Œã‚°ãƒªãƒƒãƒ‰è¡¨ç¤º
        function renderSongsGrid() {
            const grid = document.getElementById('songsGrid');
            grid.innerHTML = songsData.map(song => `
                <div class="song-card" onclick="selectSong(${song.id})">
                    <div class="song-title">${song.title}</div>
                    <div class="song-artist">${song.artist}</div>
                    <span class="song-level">${song.level}</span>
                </div>
            `).join('');
        }

        // æ­Œé¸æŠ
        function selectSong(songId) {
            currentSong = songsData.find(s => s.id === songId);
            if (currentSong) {
                document.getElementById('fillblankTab').disabled = false;
                document.getElementById('pronunciationTab').disabled = false;
                showMode('fillblank');
                initFillBlankGame();
            }
        }

        // ç©´åŸ‹ã‚ã‚²ãƒ¼ãƒ åˆæœŸåŒ–
        function initFillBlankGame() {
            document.getElementById('currentSongTitle').textContent = currentSong.title;
            document.getElementById('currentSongArtist').textContent = currentSong.artist;

            totalBlanks = currentSong.lyrics.reduce((sum, line) => sum + line.blanks.length, 0);
            correctAnswers = 0;
            updateProgress();

            const lyricsContainer = document.getElementById('lyricsContainer');
            lyricsContainer.innerHTML = currentSong.lyrics.map((line, lineIndex) => {
                let korean = line.korean;
                line.blanks.forEach((blank, blankIndex) => {
                    const inputId = `blank-${lineIndex}-${blankIndex}`;
                    korean = korean.replace(`{{${blank}}}`,
                        `<input type="text" class="blank-input" id="${inputId}" data-answer="${blank}" placeholder="?">`
                    );
                });

                return `
                    <div class="lyrics-line">
                        <div style="flex: 1;">
                            ${korean}
                            <button class="hint-btn" onclick="showHint(${lineIndex})">ãƒ’ãƒ³ãƒˆ</button>
                        </div>
                        <div class="japanese-translation" id="trans-${lineIndex}">
                            ${line.japanese}
                        </div>
                    </div>
                `;
            }).join('');

            // ç™ºéŸ³ã‚¬ã‚¤ãƒ‰æ›´æ–°
            updatePronunciationGuide();
        }

        // ç¿»è¨³è¡¨ç¤ºåˆ‡æ›¿
        function toggleTranslations() {
            const translations = document.querySelectorAll('.japanese-translation');
            translations.forEach(trans => {
                trans.classList.toggle('show');
            });
        }

        // ãƒ’ãƒ³ãƒˆè¡¨ç¤º
        function showHint(lineIndex) {
            const line = currentSong.lyrics[lineIndex];
            const blank = line.blanks[0];
            const firstChar = blank.charAt(0);
            alert(`ãƒ’ãƒ³ãƒˆ: ã€Œ${firstChar}ã€ã§å§‹ã¾ã‚Šã¾ã™`);
        }

        // ç­”ãˆåˆã‚ã›
        function checkAnswers() {
            const inputs = document.querySelectorAll('.blank-input');
            let correct = 0;

            inputs.forEach(input => {
                const answer = input.dataset.answer;
                const userAnswer = input.value.trim();

                if (userAnswer === answer) {
                    input.classList.remove('incorrect');
                    input.classList.add('correct');
                    correct++;
                } else if (userAnswer !== '') {
                    input.classList.remove('correct');
                    input.classList.add('incorrect');
                }
            });

            correctAnswers = correct;
            updateProgress();
            updateStats(correct, inputs.length);

            if (correct === inputs.length) {
                setTimeout(() => {
                    alert('ğŸ‰ å®Œç’§ã§ã™ï¼ã™ã¹ã¦æ­£è§£ã—ã¾ã—ãŸï¼');
                    stats.songsCompleted++;
                    saveStats();
                }, 500);
            }
        }

        // ã™ã¹ã¦ã®ç­”ãˆã‚’è¡¨ç¤º
        function showAllAnswers() {
            const inputs = document.querySelectorAll('.blank-input');
            inputs.forEach(input => {
                input.value = input.dataset.answer;
                input.classList.add('correct');
            });
            correctAnswers = totalBlanks;
            updateProgress();
        }

        // ã‚²ãƒ¼ãƒ ãƒªã‚»ãƒƒãƒˆ
        function resetGame() {
            const inputs = document.querySelectorAll('.blank-input');
            inputs.forEach(input => {
                input.value = '';
                input.classList.remove('correct', 'incorrect');
            });
            correctAnswers = 0;
            updateProgress();
        }

        // é€²æ—æ›´æ–°
        function updateProgress() {
            const percentage = totalBlanks > 0 ? (correctAnswers / totalBlanks) * 100 : 0;
            document.getElementById('progressFill').style.width = `${percentage}%`;
            document.getElementById('progressText').textContent = `${correctAnswers} / ${totalBlanks} æ­£è§£`;
        }

        // ç™ºéŸ³ã‚¬ã‚¤ãƒ‰æ›´æ–°
        function updatePronunciationGuide() {
            const tipsContainer = document.getElementById('pronunciationTips');
            tipsContainer.innerHTML = currentSong.pronunciationTips.map(tip => `
                <div class="pronunciation-tip">
                    <strong>${tip.word}</strong>: ${tip.tip}
                    <span style="color: ${tip.difficulty === 'hard' ? '#dc2626' : '#f59e0b'};">
                        (é›£æ˜“åº¦: ${tip.difficulty === 'hard' ? 'é«˜' : 'ä¸­'})
                    </span>
                </div>
            `).join('');

            const pronunciationLyrics = document.getElementById('pronunciationLyrics');
            pronunciationLyrics.innerHTML = currentSong.lyrics.map(line => `
                <div style="margin-bottom: 1.5rem;">
                    <div style="font-size: 1.2rem; font-weight: 700; margin-bottom: 0.5rem;">
                        ${line.korean.replace(/{{|}}/g, '')}
                    </div>
                    <div style="color: #6b7280; font-style: italic;">
                        ${line.japanese}
                    </div>
                </div>
            `).join('');
        }

        // ç™ºéŸ³å†ç”Ÿ
        function playPronunciation() {
            if ('speechSynthesis' in window) {
                const text = currentSong.lyrics.map(l => l.korean.replace(/{{|}}/g, '')).join(' ');
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'ko-KR';
                utterance.rate = 0.8; // ã‚†ã£ãã‚Š
                window.speechSynthesis.speak(utterance);
            } else {
                alert('ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯éŸ³å£°å†ç”Ÿã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚');
            }
        }

        // ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿
        function showMode(mode) {
            document.querySelectorAll('.mode-section').forEach(section => {
                section.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });

            document.getElementById(`${mode}Mode`).classList.add('active');
            event.target.classList.add('active');
        }

        // çµ±è¨ˆæ›´æ–°
        function updateStats(correct, total) {
            stats.totalCorrect += correct;
            stats.totalAttempts += total;
            saveStats();
            updateStatsDisplay();
        }

        // çµ±è¨ˆè¡¨ç¤ºæ›´æ–°
        function updateStatsDisplay() {
            const accuracy = stats.totalAttempts > 0
                ? Math.round((stats.totalCorrect / stats.totalAttempts) * 100)
                : 0;

            document.getElementById('statsContainer').innerHTML = `
                <div class="stat-card">
                    <div class="stat-value">${stats.songsCompleted}</div>
                    <div class="stat-label">å®Œäº†ã—ãŸæ­Œ</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${accuracy}%</div>
                    <div class="stat-label">æ­£ç­”ç‡</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${stats.totalCorrect}</div>
                    <div class="stat-label">ç·æ­£è§£æ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${stats.totalAttempts}</div>
                    <div class="stat-label">ç·å•é¡Œæ•°</div>
                </div>
            `;
        }

        // çµ±è¨ˆä¿å­˜
        function saveStats() {
            localStorage.setItem('korean-song-learning-stats', JSON.stringify(stats));
        }

        // çµ±è¨ˆèª­ã¿è¾¼ã¿
        function loadStats() {
            const saved = localStorage.getItem('korean-song-learning-stats');
            if (saved) {
                stats = JSON.parse(saved);
            }
        }

        // ãƒšãƒ¼ã‚¸ãƒ­ãƒ¼ãƒ‰æ™‚åˆæœŸåŒ–
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
