<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ë™ûÂΩôÂ≠¶Áøí - ÈüìÂõΩË™ûÂçòË™û„Éû„Çπ„Çø„Éº</title>
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <style>
        :root {
            --primary: #ec4899;
            --primary-dark: #db2777;
            --font-sans: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: var(--font-sans);
            background: linear-gradient(135deg, #ec4899 0%, #db2777 100%);
            min-height: 100vh;
            padding: 1rem;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 1.5rem 2rem;
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-title { display: flex; align-items: center; gap: 1rem; }
        .header-title h1 { font-size: 1.75rem; color: var(--primary); }

        .home-btn {
            padding: 0.5rem 1.5rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: 600;
            text-decoration: none;
            display: inline-block;
        }

        .content-area {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            min-height: 500px;
        }

        /* „É¨„Éô„É´ÈÅ∏Êäû */
        .levels-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .level-card {
            background: linear-gradient(135deg, #fce7f3 0%, #fbcfe8 100%);
            padding: 1.5rem;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: all 0.3s;
            border: 3px solid transparent;
            text-align: center;
        }

        .level-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
            box-shadow: 0 10px 20px rgba(236, 72, 153, 0.3);
        }

        .level-card.active {
            border-color: var(--primary);
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
        }

        .level-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .level-desc {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        /* „Éï„É©„ÉÉ„Ç∑„É•„Ç´„Éº„Éâ */
        .flashcard-container {
            max-width: 600px;
            margin: 2rem auto;
            perspective: 1000px;
        }

        .flashcard {
            width: 100%;
            min-height: 400px;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s;
            cursor: pointer;
        }

        .flashcard.flipped {
            transform: rotateY(180deg);
        }

        .card-face {
            position: absolute;
            width: 100%;
            min-height: 400px;
            backface-visibility: hidden;
            border-radius: 1rem;
            padding: 3rem;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .card-front {
            background: linear-gradient(135deg, #fce7f3 0%, #fbcfe8 100%);
        }

        .card-back {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            transform: rotateY(180deg);
        }

        .korean-word {
            font-size: 4rem;
            font-weight: 700;
            color: #831843;
            margin-bottom: 1rem;
        }

        .reading {
            font-size: 1.5rem;
            color: #9f1239;
            margin-bottom: 0.5rem;
        }

        .word-type {
            font-size: 1rem;
            color: #be185d;
            padding: 0.25rem 1rem;
            background: white;
            border-radius: 0.5rem;
            display: inline-block;
        }

        .audio-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .audio-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(0,0,0,0.2);
        }

        .audio-btn:active {
            transform: scale(0.95);
        }

        .meaning {
            font-size: 2rem;
            font-weight: 600;
            color: #1e40af;
            margin-bottom: 1.5rem;
        }

        .example {
            font-size: 1.1rem;
            color: #1e3a8a;
            margin-bottom: 0.5rem;
            line-height: 1.6;
        }

        .example-translation {
            font-size: 1rem;
            color: #3730a3;
            font-style: italic;
        }

        /* „Ç≥„É≥„Éà„É≠„Éº„É´ */
        .controls {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
            flex-wrap: wrap;
        }

        .btn {
            padding: 0.75rem 2rem;
            border: none;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        /* ÈÄ≤Êçó */
        .progress-container {
            margin-bottom: 2rem;
        }

        .progress-bar {
            background: #e5e7eb;
            height: 12px;
            border-radius: 6px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary) 0%, var(--primary-dark) 100%);
            transition: width 0.5s ease;
        }

        .progress-text {
            text-align: center;
            margin-top: 0.5rem;
            color: #6b7280;
            font-weight: 600;
        }

        /* „ÇØ„Ç§„Ç∫„É¢„Éº„Éâ */
        .quiz-container {
            max-width: 600px;
            margin: 0 auto;
        }

        .quiz-question {
            background: linear-gradient(135deg, #fce7f3 0%, #fbcfe8 100%);
            padding: 2rem;
            border-radius: 1rem;
            margin-bottom: 2rem;
            text-align: center;
        }

        .quiz-word {
            font-size: 3rem;
            font-weight: 700;
            color: #831843;
            margin-bottom: 1rem;
        }

        .quiz-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }

        .quiz-option {
            padding: 1.5rem;
            background: white;
            border: 3px solid #e5e7eb;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .quiz-option:hover {
            border-color: var(--primary);
            transform: scale(1.05);
        }

        .quiz-option.correct {
            background: #dcfce7;
            border-color: #10b981;
        }

        .quiz-option.incorrect {
            background: #fee2e2;
            border-color: #ef4444;
        }

        @media (max-width: 768px) {
            .header { flex-direction: column; gap: 1rem; }
            .korean-word { font-size: 2.5rem; }
            .meaning { font-size: 1.5rem; }
            .quiz-options { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-title">
                <span style="font-size: 2rem;">üìö</span>
                <h1>Ë™ûÂΩôÂ≠¶Áøí„É¢„Éº„Éâ</h1>
            </div>
            <a href="../index.html" class="home-btn">„Éõ„Éº„É†„Å´Êàª„Çã</a>
        </div>

        <div class="content-area">
            <!-- „É¨„Éô„É´ÈÅ∏Êäû -->
            <div id="levelSelect">
                <h2 style="margin-bottom: 1.5rem; text-align: center; color: #111827;">
                    Â≠¶Áøí„É¨„Éô„É´„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ
                </h2>
                <div class="levels-grid" id="levelsGrid"></div>
            </div>

            <!-- Â≠¶Áøí„É¢„Éº„ÉâÈÅ∏Êäû -->
            <div id="modeSelect" style="display: none;">
                <div id="selectedLevelInfo" style="text-align: center; margin-bottom: 1rem; padding: 1rem; background: linear-gradient(135deg, #fce7f3 0%, #fbcfe8 100%); border-radius: 0.75rem;">
                    <div style="font-size: 0.9rem; color: #9f1239; font-weight: 600; margin-bottom: 0.25rem;">ÈÅ∏Êäû‰∏≠„ÅÆ„É¨„Éô„É´</div>
                    <div id="currentLevelDisplay" style="font-size: 1.5rem; font-weight: 700; color: #831843;"></div>
                    <div id="currentWordCount" style="font-size: 0.95rem; color: #9f1239; margin-top: 0.25rem;"></div>
                </div>
                <h2 style="margin-bottom: 1.5rem; text-align: center; color: #111827;">
                    Â≠¶ÁøíÊñπÊ≥ï„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ
                </h2>
                <div class="controls">
                    <button class="btn btn-primary" onclick="startFlashcard()">„Éï„É©„ÉÉ„Ç∑„É•„Ç´„Éº„Éâ</button>
                    <button class="btn btn-primary" onclick="startQuiz()">„ÇØ„Ç§„Ç∫ÂΩ¢Âºè</button>
                    <button class="btn btn-secondary" onclick="backToLevelSelect()">„É¨„Éô„É´ÈÅ∏Êäû„Å´Êàª„Çã</button>
                </div>
            </div>

            <!-- „Éï„É©„ÉÉ„Ç∑„É•„Ç´„Éº„Éâ„É¢„Éº„Éâ -->
            <div id="flashcardMode" style="display: none;">
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                    </div>
                    <div class="progress-text" id="progressText">0 / 0</div>
                </div>

                <div class="flashcard-container">
                    <div class="flashcard" id="flashcard" onclick="flipCard()">
                        <div class="card-face card-front" id="cardFront"></div>
                        <div class="card-face card-back" id="cardBack"></div>
                    </div>
                </div>

                <div class="controls">
                    <button class="btn btn-secondary" onclick="previousCard()">‚¨Ö Ââç„Å∏</button>
                    <button class="btn btn-primary" onclick="flipCard()">„Ç´„Éº„Éâ„Çí„ÇÅ„Åè„Çã</button>
                    <button class="btn btn-secondary" onclick="nextCard()">Ê¨°„Å∏ ‚û°</button>
                </div>
                <div class="controls">
                    <button class="btn btn-secondary" onclick="backToModeSelect()">„É¢„Éº„ÉâÈÅ∏Êäû„Å´Êàª„Çã</button>
                </div>
                <div style="text-align: center; margin-top: 1rem; padding: 1rem; background: #f3f4f6; border-radius: 0.5rem; color: #6b7280; font-size: 0.9rem;">
                    ‚å®Ô∏è <strong>„Ç≠„Éº„Éú„Éº„Éâ„Ç∑„Éß„Éº„Éà„Ç´„ÉÉ„Éà:</strong>
                    <span style="margin: 0 0.5rem;">„Çπ„Éö„Éº„Çπ/Enter: „ÇÅ„Åè„Çã</span>
                    <span style="margin: 0 0.5rem;">‚Üê / P: Ââç„Å∏</span>
                    <span style="margin: 0 0.5rem;">‚Üí / N: Ê¨°„Å∏</span>
                    <span style="margin: 0 0.5rem;">R: Èü≥Â£∞ÂÜçÁîü</span>
                </div>
            </div>

            <!-- „ÇØ„Ç§„Ç∫„É¢„Éº„Éâ -->
            <div id="quizMode" style="display: none;">
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="quizProgressFill" style="width: 0%"></div>
                    </div>
                    <div class="progress-text" id="quizProgressText">0 / 0</div>
                </div>

                <div class="quiz-container">
                    <div class="quiz-question">
                        <div class="quiz-word" id="quizWord"></div>
                        <p style="color: #6b7280; margin-top: 1rem;">Ê≠£„Åó„ÅÑÊÑèÂë≥„ÇíÈÅ∏„Çì„Åß„Åè„Å†„Åï„ÅÑ</p>
                    </div>
                    <div class="quiz-options" id="quizOptions"></div>
                </div>

                <div class="controls">
                    <button class="btn btn-secondary" onclick="backToModeSelect()">„É¢„Éº„ÉâÈÅ∏Êäû„Å´Êàª„Çã</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let vocabularyData = [];
        let currentLevel = null;
        let currentWords = [];
        let currentIndex = 0;
        let quizScore = 0;
        let speechSynthesis = window.speechSynthesis;
        let koreaVoice = null;

        async function init() {
            console.log('ÂàùÊúüÂåñÈñãÂßã');

            await loadVocabularyData();
            console.log('„Éá„Éº„ÇøË™≠„ÅøËæº„ÅøÂÆå‰∫Ü');

            renderLevelSelect();
            initSpeech();

            // ÂàùÊúüÁä∂ÊÖã: „É¨„Éô„É´ÈÅ∏ÊäûÁîªÈù¢„ÅÆ„ÅøË°®Á§∫
            hideAllScreens();
            document.getElementById('levelSelect').style.display = 'block';

            console.log('ÂàùÊúüÂåñÂÆå‰∫Ü');
        }

        // Èü≥Â£∞ÂêàÊàê„ÅÆÂàùÊúüÂåñ
        function initSpeech() {
            if ('speechSynthesis' in window) {
                // ÈüìÂõΩË™ûÈü≥Â£∞„ÇíÊé¢„Åô
                const loadVoices = () => {
                    const voices = speechSynthesis.getVoices();
                    koreaVoice = voices.find(voice => voice.lang.startsWith('ko')) || voices[0];
                };

                loadVoices();
                if (speechSynthesis.onvoiceschanged !== undefined) {
                    speechSynthesis.onvoiceschanged = loadVoices;
                }
            }
        }

        // ÈüìÂõΩË™û„ÇíË™≠„Åø‰∏ä„Åí„ÇãÔºàÊúÄÈÅ©ÂåñÁâàÔºâ
        function speakKorean(text) {
            if (!speechSynthesis) return;

            // Êó¢Â≠ò„ÅÆÈü≥Â£∞„ÇíÂÅúÊ≠¢
            speechSynthesis.cancel();

            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'ko-KR';
            utterance.rate = 0.9; // Ëá™ÁÑ∂„Å™ÈÄüÂ∫¶
            utterance.pitch = 1.0;
            utterance.volume = 1.0;

            if (koreaVoice) {
                utterance.voice = koreaVoice;
            }

            // „Éñ„É©„Ç¶„Ç∂„ÅÆÂà∂Èôê„ÇíÂõûÈÅø„Åô„Çã„Åü„ÇÅ„ÄÅ„Åô„Åê„Å´ÂÜçÁîü„ÇíÈñãÂßã
            // Chrome„ÇÑSafari„Åß„ÅØÂàùÂõû„Å´ÈÅÖÂª∂„ÅåÁô∫Áîü„Åô„Çã„Åì„Å®„Åå„ÅÇ„Çã„Åå„ÄÅ
            // 2ÂõûÁõÆ‰ª•Èôç„ÅØÂç≥Â∫ß„Å´ÂÜçÁîü„Åï„Çå„Çã
            requestAnimationFrame(() => {
                speechSynthesis.speak(utterance);
            });
        }

        async function loadVocabularyData() {
            try {
                const response = await fetch('../data/vocabulary/vocabulary-data.json');
                vocabularyData = await response.json();
            } catch (error) {
                console.error('Ë™ûÂΩô„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Ç®„É©„Éº:', error);
                vocabularyData = getDemoVocabulary();
            }
        }

        function getDemoVocabulary() {
            return {
                beginner: [
                    { korean: "ÏïàÎÖïÌïòÏÑ∏Ïöî", reading: "„Ç¢„É≥„Éã„Éß„É≥„Éè„Çª„É®", meaning: "„Åì„Çì„Å´„Å°„ÅØ", type: "Êå®Êã∂", example: "ÏïàÎÖïÌïòÏÑ∏Ïöî, ÎßåÎÇòÏÑú Î∞òÍ∞ëÏäµÎãàÎã§", exampleTranslation: "„Åì„Çì„Å´„Å°„ÅØ„ÄÅ„Åä‰ºö„ÅÑ„Åß„Åç„Å¶Â¨â„Åó„ÅÑ„Åß„Åô" },
                    { korean: "Í∞êÏÇ¨Ìï©ÎãàÎã§", reading: "„Ç´„É†„Çµ„Éè„É†„Éã„ÉÄ", meaning: "„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô", type: "Êå®Êã∂", example: "ÎèÑÏôÄÏ£ºÏÖîÏÑú Í∞êÏÇ¨Ìï©ÎãàÎã§", exampleTranslation: "Âä©„Åë„Å¶„ÅÑ„Åü„Å†„Åç„ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô" },
                    { korean: "ÏÇ¨Îûë", reading: "„Çµ„É©„É≥", meaning: "ÊÑõ", type: "ÂêçË©û", example: "ÏÇ¨ÎûëÏù¥ ÌïÑÏöîÌï¥Ïöî", exampleTranslation: "ÊÑõ„ÅåÂøÖË¶Å„Åß„Åô" },
                    { korean: "ÌïôÏÉù", reading: "„Éè„ÇØ„Çª„É≥", meaning: "Â≠¶Áîü", type: "ÂêçË©û", example: "Ï†ÄÎäî ÎåÄÌïôÏÉùÏûÖÎãàÎã§", exampleTranslation: "ÁßÅ„ÅØÂ§ßÂ≠¶Áîü„Åß„Åô" },
                    { korean: "ÏπúÍµ¨", reading: "„ÉÅ„É≥„Ç∞", meaning: "ÂèãÈÅî", type: "ÂêçË©û", example: "ÏπúÍµ¨Î•º ÎßåÎÇòÏöî", exampleTranslation: "ÂèãÈÅî„Å´‰ºö„ÅÑ„Åæ„Åô" }
                ],
                intermediate: [
                    { korean: "ÌñâÎ≥µ", reading: "„Éò„É≥„Éú„ÇØ", meaning: "Âπ∏„Åõ", type: "ÂêçË©û", example: "ÌñâÎ≥µÌïú ÌïòÎ£® Î≥¥ÎÇ¥ÏÑ∏Ïöî", exampleTranslation: "Âπ∏„Åõ„Å™‰∏ÄÊó•„Çí„ÅäÈÅé„Åî„Åó„Åè„Å†„Åï„ÅÑ" },
                    { korean: "ÎÖ∏Î†•", reading: "„Éé„É™„Éß„ÇØ", meaning: "Âä™Âäõ", type: "ÂêçË©û", example: "ÎÖ∏Î†•ÌïòÎ©¥ ÏÑ±Í≥µÌï† Ïàò ÏûàÏñ¥Ïöî", exampleTranslation: "Âä™Âäõ„Åô„Çå„Å∞ÊàêÂäü„Åß„Åç„Åæ„Åô" },
                    { korean: "Ïó¨Ìñâ", reading: "„É®„Éò„É≥", meaning: "ÊóÖË°å", type: "ÂêçË©û", example: "ÌïúÍµ≠ Ïó¨ÌñâÏùÑ Í∞îÏñ¥Ïöî", exampleTranslation: "ÈüìÂõΩÊóÖË°å„Å´Ë°å„Åç„Åæ„Åó„Åü" },
                    { korean: "ÌöåÏÇ¨", reading: "„Éï„Çß„Çµ", meaning: "‰ºöÁ§æ", type: "ÂêçË©û", example: "ÌöåÏÇ¨ÏóêÏÑú ÏùºÌï¥Ïöî", exampleTranslation: "‰ºöÁ§æ„ÅßÂÉç„ÅÑ„Å¶„ÅÑ„Åæ„Åô" },
                    { korean: "ÏùåÏãù", reading: "„Ç¶„É†„Ç∑„ÇØ", meaning: "È£ü„ÅπÁâ©", type: "ÂêçË©û", example: "ÌïúÍµ≠ ÏùåÏãùÏùÑ Ï¢ãÏïÑÌï¥Ïöî", exampleTranslation: "ÈüìÂõΩÊñôÁêÜ„ÅåÂ•Ω„Åç„Åß„Åô" }
                ],
                advanced: [
                    { korean: "ÏÑ±Ï∑®Í∞ê", reading: "„ÇΩ„É≥„ÉÅ„É•„Ç£„Ç¨„É†", meaning: "ÈÅîÊàêÊÑü", type: "ÂêçË©û", example: "ÌÅ∞ ÏÑ±Ï∑®Í∞êÏùÑ ÎäêÍºàÏñ¥Ïöî", exampleTranslation: "Â§ß„Åç„Å™ÈÅîÊàêÊÑü„ÇíÊÑü„Åò„Åæ„Åó„Åü" },
                    { korean: "Ïù∏ÎÇ¥Ïã¨", reading: "„Ç§„É≥„Éç„Ç∑„É†", meaning: "ÂøçËÄêÂäõ", type: "ÂêçË©û", example: "Ïù∏ÎÇ¥Ïã¨Ïù¥ ÌïÑÏöîÌï©ÎãàÎã§", exampleTranslation: "ÂøçËÄêÂäõ„ÅåÂøÖË¶Å„Åß„Åô" },
                    { korean: "Î∞úÏ†Ñ", reading: "„Éë„É´„Ç∏„Éß„É≥", meaning: "Áô∫Â±ï", type: "ÂêçË©û", example: "Í≤ΩÏ†úÍ∞Ä Î∞úÏ†ÑÌïòÍ≥† ÏûàÏñ¥Ïöî", exampleTranslation: "ÁµåÊ∏à„ÅåÁô∫Â±ï„Åó„Å¶„ÅÑ„Åæ„Åô" },
                    { korean: "ÌòëÎ†•", reading: "„Éí„Éß„Éó„É™„Éß„ÇØ", meaning: "ÂçîÂäõ", type: "ÂêçË©û", example: "ÌåÄÏõåÌÅ¨ÏôÄ ÌòëÎ†•Ïù¥ Ï§ëÏöîÌï¥Ïöî", exampleTranslation: "„ÉÅ„Éº„É†„ÉØ„Éº„ÇØ„Å®ÂçîÂäõ„ÅåÈáçË¶Å„Åß„Åô" },
                    { korean: "Ï∞ΩÏùòÏÑ±", reading: "„ÉÅ„É£„É≥„Ç¶„Ç£„ÇΩ„É≥", meaning: "ÂâµÈÄ†ÊÄß", type: "ÂêçË©û", example: "Ï∞ΩÏùòÏÑ±ÏùÑ Î∞úÌúòÌïòÏÑ∏Ïöî", exampleTranslation: "ÂâµÈÄ†ÊÄß„ÇíÁô∫ÊèÆ„Åó„Å¶„Åè„Å†„Åï„ÅÑ" }
                ]
            };
        }

        function renderLevelSelect() {
            const grid = document.getElementById('levelsGrid');

            const levels = [
                { key: 'beginner', title: 'ÂàùÁ¥ö', desc: 'Âü∫Á§éÂçòË™û' },
                { key: 'intermediate', title: '‰∏≠Á¥ö', desc: 'Êó•Â∏∏ÂçòË™û' },
                { key: 'advanced', title: '‰∏äÁ¥ö', desc: 'È´òÁ¥öÂçòË™û' }
            ];

            grid.innerHTML = levels.map(level => {
                const wordCount = vocabularyData[level.key]?.length || 0;
                const isSelected = currentLevel === level.key;
                return `
                    <div class="level-card ${isSelected ? 'active' : ''}" onclick="selectLevel('${level.key}')">
                        <div class="level-title">${level.title}</div>
                        <div class="level-desc">${level.desc} ${wordCount}Ë™û</div>
                    </div>
                `;
            }).join('');
        }

        // Áä∂ÊÖã„ÇíÂÆåÂÖ®„Å´„É™„Çª„ÉÉ„Éà
        function resetState() {
            currentIndex = 0;
            quizScore = 0;
            speechSynthesis.cancel(); // Èü≥Â£∞ÂÅúÊ≠¢

            // „Éï„É©„ÉÉ„Ç∑„É•„Ç´„Éº„Éâ„Çí„É™„Çª„ÉÉ„Éà
            const flashcard = document.getElementById('flashcard');
            if (flashcard) {
                flashcard.classList.remove('flipped');
            }
        }

        // „Åô„Åπ„Å¶„ÅÆÁîªÈù¢„ÇíÈùûË°®Á§∫
        function hideAllScreens() {
            document.getElementById('levelSelect').style.display = 'none';
            document.getElementById('modeSelect').style.display = 'none';
            document.getElementById('flashcardMode').style.display = 'none';
            document.getElementById('quizMode').style.display = 'none';
        }

        function selectLevel(level) {
            console.log('„É¨„Éô„É´ÈÅ∏Êäû:', level);

            // Áä∂ÊÖã„ÇíÂÆåÂÖ®„Å´„É™„Çª„ÉÉ„Éà
            resetState();

            // Êñ∞„Åó„ÅÑ„É¨„Éô„É´„ÇíË®≠ÂÆö
            currentLevel = level;
            currentWords = vocabularyData[level] || [];

            // „Éá„Éº„Çø„ÅåÊ≠£„Åó„Åè„É≠„Éº„Éâ„Åï„Çå„Åü„ÅãÁ¢∫Ë™ç
            if (currentWords.length === 0) {
                console.error('ÂçòË™û„Éá„Éº„Çø„ÅåÁ©∫„Åß„Åô„ÄÇ„É¨„Éô„É´:', level);
                alert('ÂçòË™û„Éá„Éº„Çø„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ');
                return;
            }

            console.log('Ë™≠„ÅøËæº„Åæ„Çå„ÅüÂçòË™ûÊï∞:', currentWords.length);
            console.log('ÊúÄÂàù„ÅÆÂçòË™û:', currentWords[0]);

            // ÈÅ∏Êäû„Åï„Çå„Åü„É¨„Éô„É´ÊÉÖÂ†±„ÇíÊõ¥Êñ∞
            const levelNames = {
                'beginner': 'ÂàùÁ¥ö',
                'intermediate': '‰∏≠Á¥ö',
                'advanced': '‰∏äÁ¥ö'
            };

            document.getElementById('currentLevelDisplay').textContent = levelNames[level] || level;
            document.getElementById('currentWordCount').textContent = `${currentWords.length}ÂÄã„ÅÆÂçòË™û`;

            // ÁîªÈù¢ÈÅ∑Áßª
            hideAllScreens();
            document.getElementById('modeSelect').style.display = 'block';
        }

        function backToLevelSelect() {
            console.log('„É¨„Éô„É´ÈÅ∏Êäû„Å´Êàª„Çã');

            resetState();
            currentLevel = null;
            currentWords = [];

            hideAllScreens();
            document.getElementById('levelSelect').style.display = 'block';

            // „É¨„Éô„É´ÈÅ∏ÊäûÁîªÈù¢„ÇíÂÜç„É¨„É≥„ÉÄ„É™„É≥„Ç∞ÔºàÈÅ∏ÊäûÁä∂ÊÖã„Çí„ÇØ„É™„Ç¢Ôºâ
            renderLevelSelect();
        }

        function startFlashcard() {
            // „Éá„Éº„Çø„ÅåÂ≠òÂú®„Åô„Çã„ÅãÂÜçÁ¢∫Ë™ç
            if (!currentLevel || currentWords.length === 0) {
                console.error('„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ„É¨„Éô„É´:', currentLevel);
                alert('ÂÖà„Å´„É¨„Éô„É´„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                backToLevelSelect();
                return;
            }

            console.log('„Éï„É©„ÉÉ„Ç∑„É•„Ç´„Éº„ÉâÈñãÂßã„ÄÇÂçòË™ûÊï∞:', currentWords.length);

            resetState();

            hideAllScreens();
            document.getElementById('flashcardMode').style.display = 'block';

            // ÊúÄÂàù„ÅÆ„Ç´„Éº„Éâ„ÇíË°®Á§∫
            showCard();
        }

        function startQuiz() {
            // „Éá„Éº„Çø„ÅåÂ≠òÂú®„Åô„Çã„ÅãÂÜçÁ¢∫Ë™ç
            if (!currentLevel || currentWords.length === 0) {
                console.error('„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ„É¨„Éô„É´:', currentLevel);
                alert('ÂÖà„Å´„É¨„Éô„É´„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                backToLevelSelect();
                return;
            }

            // „ÇØ„Ç§„Ç∫„Å´„ÅØÊúÄ‰Ωé4„Å§„ÅÆÂçòË™û„ÅåÂøÖË¶Å
            if (currentWords.length < 4) {
                alert('„ÇØ„Ç§„Ç∫„Å´„ÅØÊúÄ‰Ωé4„Å§„ÅÆÂçòË™û„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ');
                return;
            }

            console.log('„ÇØ„Ç§„Ç∫ÈñãÂßã„ÄÇÂçòË™ûÊï∞:', currentWords.length);

            resetState();

            hideAllScreens();
            document.getElementById('quizMode').style.display = 'block';

            showQuiz();
        }

        function backToModeSelect() {
            // „Éá„Éº„Çø„ÅåÂ§±„Çè„Çå„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØ„É¨„Éô„É´ÈÅ∏Êäû„Å´Êàª„Çã
            if (!currentLevel || currentWords.length === 0) {
                console.warn('„Éá„Éº„Çø„ÅåÂ§±„Çè„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ„É¨„Éô„É´ÈÅ∏Êäû„Å´Êàª„Çä„Åæ„Åô„ÄÇ');
                backToLevelSelect();
                return;
            }

            resetState();

            hideAllScreens();
            document.getElementById('modeSelect').style.display = 'block';
        }

        function showCard() {
            // ÂÆâÂÖ®ÊÄß„ÉÅ„Çß„ÉÉ„ÇØ
            if (!currentWords || currentWords.length === 0) {
                console.error('showCard: ÂçòË™û„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì');
                return;
            }

            if (currentIndex < 0 || currentIndex >= currentWords.length) {
                console.error('showCard: ÁÑ°Âäπ„Å™„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ', currentIndex);
                currentIndex = 0;
            }

            const word = currentWords[currentIndex];

            if (!word) {
                console.error('showCard: ÂçòË™û„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„ÄÇ„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ:', currentIndex);
                return;
            }

            console.log('„Ç´„Éº„ÉâË°®Á§∫:', currentIndex + 1, '/', currentWords.length, '-', word.korean);

            document.getElementById('cardFront').innerHTML = `
                <button class="audio-btn" onclick="event.stopPropagation(); replayAudio('front')" title="Èü≥Â£∞„ÇíÂÜçÁîü">üîä</button>
                <div class="korean-word">${word.korean}</div>
                <div class="reading">${word.reading}</div>
                <div class="word-type">${word.type}</div>
            `;

            document.getElementById('cardBack').innerHTML = `
                <button class="audio-btn" onclick="event.stopPropagation(); replayAudio('back')" title="‰æãÊñá„ÇíÂÜçÁîü">üîä</button>
                <div class="meaning">${word.meaning}</div>
                <div class="example">${word.example}</div>
                <div class="example-translation">${word.exampleTranslation}</div>
            `;

            updateProgress();
            document.getElementById('flashcard').classList.remove('flipped');

            // „Ç´„Éº„Éâ„ÅåË°®Á§∫„Åï„Çå„Åü„ÇâÂç≥Â∫ß„Å´Èü≥Â£∞ÂÜçÁîü
            speakKorean(word.korean);
        }

        // Èü≥Â£∞„ÇíÂÜçÁîü
        function replayAudio(side) {
            if (currentWords.length === 0) return;
            const word = currentWords[currentIndex];

            if (side === 'front') {
                speakKorean(word.korean);
            } else {
                speakKorean(word.example);
            }
        }

        function flipCard() {
            const flashcard = document.getElementById('flashcard');
            const isFlipped = flashcard.classList.toggle('flipped');

            // „Ç´„Éº„Éâ„ÅåË£èËøî„Åï„Çå„Åü„Çâ‰æãÊñá„ÇíÂç≥Â∫ß„Å´Ë™≠„Åø‰∏ä„Åí
            if (isFlipped && currentWords.length > 0) {
                const word = currentWords[currentIndex];
                // CSS transition„ÅåÂßã„Åæ„Å£„ÅüÂæå„Å´ÂÜçÁîü
                requestAnimationFrame(() => {
                    speakKorean(word.example);
                });
            }
        }

        function nextCard() {
            currentIndex = (currentIndex + 1) % currentWords.length;
            showCard();
        }

        function previousCard() {
            currentIndex = (currentIndex - 1 + currentWords.length) % currentWords.length;
            showCard();
        }

        function updateProgress() {
            const progress = ((currentIndex + 1) / currentWords.length) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
            document.getElementById('progressText').textContent = `${currentIndex + 1} / ${currentWords.length}`;
        }

        function showQuiz() {
            // ÂÆâÂÖ®ÊÄß„ÉÅ„Çß„ÉÉ„ÇØ
            if (!currentWords || currentWords.length === 0) {
                console.error('showQuiz: ÂçòË™û„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì');
                backToLevelSelect();
                return;
            }

            if (currentIndex < 0 || currentIndex >= currentWords.length) {
                console.error('showQuiz: ÁÑ°Âäπ„Å™„Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ', currentIndex);
                currentIndex = 0;
            }

            const word = currentWords[currentIndex];

            if (!word) {
                console.error('showQuiz: ÂçòË™û„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                return;
            }

            console.log('„ÇØ„Ç§„Ç∫Ë°®Á§∫:', currentIndex + 1, '/', currentWords.length, '-', word.korean);

            document.getElementById('quizWord').textContent = word.korean;

            const correctAnswer = word.meaning;
            const wrongAnswers = currentWords
                .filter(w => w.meaning !== correctAnswer)
                .sort(() => Math.random() - 0.5)
                .slice(0, 3)
                .map(w => w.meaning);

            const allOptions = [correctAnswer, ...wrongAnswers].sort(() => Math.random() - 0.5);

            const optionsContainer = document.getElementById('quizOptions');
            optionsContainer.innerHTML = allOptions.map(option => `
                <div class="quiz-option" onclick="selectAnswer('${option}', '${correctAnswer}')">
                    ${option}
                </div>
            `).join('');

            const progress = ((currentIndex + 1) / currentWords.length) * 100;
            document.getElementById('quizProgressFill').style.width = `${progress}%`;
            document.getElementById('quizProgressText').textContent = `${currentIndex + 1} / ${currentWords.length}`;
        }

        function selectAnswer(selected, correct) {
            const options = document.querySelectorAll('.quiz-option');
            options.forEach(option => {
                option.style.pointerEvents = 'none';
                if (option.textContent.trim() === correct) {
                    option.classList.add('correct');
                } else if (option.textContent.trim() === selected) {
                    option.classList.add('incorrect');
                }
            });

            if (selected === correct) {
                quizScore++;
            }

            setTimeout(() => {
                currentIndex++;
                if (currentIndex < currentWords.length) {
                    showQuiz();
                } else {
                    alert(`„ÇØ„Ç§„Ç∫ÂÆå‰∫ÜÔºÅ„Çπ„Ç≥„Ç¢: ${quizScore} / ${currentWords.length}`);
                    backToModeSelect();
                }
            }, 1500);
        }

        // „Ç≠„Éº„Éú„Éº„Éâ„Ç∑„Éß„Éº„Éà„Ç´„ÉÉ„Éà
        document.addEventListener('keydown', (e) => {
            // „Éï„É©„ÉÉ„Ç∑„É•„Ç´„Éº„Éâ„É¢„Éº„Éâ„ÅåË°®Á§∫„Åï„Çå„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅÆ„Åø
            const flashcardMode = document.getElementById('flashcardMode');
            if (flashcardMode.style.display === 'none') return;

            switch(e.key) {
                case ' ':  // „Çπ„Éö„Éº„Çπ„Ç≠„Éº
                case 'Enter':  // „Ç®„É≥„Çø„Éº„Ç≠„Éº
                    e.preventDefault();
                    flipCard();
                    break;
                case 'ArrowRight':  // Âè≥Áü¢Âç∞
                case 'n':  // N„Ç≠„ÉºÔºàNextÔºâ
                    e.preventDefault();
                    nextCard();
                    break;
                case 'ArrowLeft':  // Â∑¶Áü¢Âç∞
                case 'p':  // P„Ç≠„ÉºÔºàPreviousÔºâ
                    e.preventDefault();
                    previousCard();
                    break;
                case 'r':  // R„Ç≠„ÉºÔºàReplayÔºâ
                    e.preventDefault();
                    if (currentWords.length > 0) {
                        const word = currentWords[currentIndex];
                        const isFlipped = document.getElementById('flashcard').classList.contains('flipped');
                        speakKorean(isFlipped ? word.example : word.korean);
                    }
                    break;
            }
        });

        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
