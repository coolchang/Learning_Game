<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èªå½™å­¦ç¿’ - éŸ“å›½èªå˜èªãƒã‚¹ã‚¿ãƒ¼</title>
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <style>
        :root {
            --primary: #ec4899;
            --primary-dark: #db2777;
            --font-sans: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: var(--font-sans);
            background: linear-gradient(135deg, #ec4899 0%, #db2777 100%);
            min-height: 100vh;
            padding: 1rem;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 1.5rem 2rem;
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-title { display: flex; align-items: center; gap: 1rem; }
        .header-title h1 { font-size: 1.75rem; color: var(--primary); }

        .home-btn {
            padding: 0.5rem 1.5rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: 600;
            text-decoration: none;
            display: inline-block;
        }

        .content-area {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
            min-height: 500px;
        }

        /* ãƒ¬ãƒ™ãƒ«é¸æŠ */
        .levels-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .level-card {
            background: linear-gradient(135deg, #fce7f3 0%, #fbcfe8 100%);
            padding: 1.5rem;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: all 0.3s;
            border: 3px solid transparent;
            text-align: center;
        }

        .level-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
            box-shadow: 0 10px 20px rgba(236, 72, 153, 0.3);
        }

        .level-card.active {
            border-color: var(--primary);
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
        }

        .level-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .level-desc {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        /* ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚«ãƒ¼ãƒ‰ */
        .flashcard-container {
            max-width: 600px;
            margin: 2rem auto;
            perspective: 1000px;
        }

        .flashcard {
            width: 100%;
            min-height: 400px;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s;
            cursor: pointer;
        }

        .flashcard.flipped {
            transform: rotateY(180deg);
        }

        .card-face {
            position: absolute;
            width: 100%;
            min-height: 400px;
            backface-visibility: hidden;
            border-radius: 1rem;
            padding: 3rem;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .card-front {
            background: linear-gradient(135deg, #fce7f3 0%, #fbcfe8 100%);
        }

        .card-back {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            transform: rotateY(180deg);
        }

        .korean-word {
            font-size: 4rem;
            font-weight: 700;
            color: #831843;
            margin-bottom: 1rem;
        }

        .reading {
            font-size: 1.5rem;
            color: #9f1239;
            margin-bottom: 0.5rem;
        }

        .word-type {
            font-size: 1rem;
            color: #be185d;
            padding: 0.25rem 1rem;
            background: white;
            border-radius: 0.5rem;
            display: inline-block;
        }

        .audio-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-size: 1.5rem;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .audio-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(0,0,0,0.2);
        }

        .audio-btn:active {
            transform: scale(0.95);
        }

        .meaning {
            font-size: 2rem;
            font-weight: 600;
            color: #1e40af;
            margin-bottom: 1.5rem;
        }

        .example {
            font-size: 1.1rem;
            color: #1e3a8a;
            margin-bottom: 0.5rem;
            line-height: 1.6;
        }

        .example-translation {
            font-size: 1rem;
            color: #3730a3;
            font-style: italic;
        }

        /* ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« */
        .controls {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 2rem;
            flex-wrap: wrap;
        }

        .btn {
            padding: 0.75rem 2rem;
            border: none;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        /* é€²æ— */
        .progress-container {
            margin-bottom: 2rem;
        }

        .progress-bar {
            background: #e5e7eb;
            height: 12px;
            border-radius: 6px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary) 0%, var(--primary-dark) 100%);
            transition: width 0.5s ease;
        }

        .progress-text {
            text-align: center;
            margin-top: 0.5rem;
            color: #6b7280;
            font-weight: 600;
        }

        /* ã‚¯ã‚¤ã‚ºãƒ¢ãƒ¼ãƒ‰ */
        .quiz-container {
            max-width: 600px;
            margin: 0 auto;
        }

        .quiz-question {
            background: linear-gradient(135deg, #fce7f3 0%, #fbcfe8 100%);
            padding: 2rem;
            border-radius: 1rem;
            margin-bottom: 2rem;
            text-align: center;
        }

        .quiz-word {
            font-size: 3rem;
            font-weight: 700;
            color: #831843;
            margin-bottom: 1rem;
        }

        .quiz-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }

        .quiz-option {
            padding: 1.5rem;
            background: white;
            border: 3px solid #e5e7eb;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .quiz-option:hover {
            border-color: var(--primary);
            transform: scale(1.05);
        }

        .quiz-option.correct {
            background: #dcfce7;
            border-color: #10b981;
        }

        .quiz-option.incorrect {
            background: #fee2e2;
            border-color: #ef4444;
        }

        @media (max-width: 768px) {
            .header { flex-direction: column; gap: 1rem; }
            .korean-word { font-size: 2.5rem; }
            .meaning { font-size: 1.5rem; }
            .quiz-options { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-title">
                <span style="font-size: 2rem;">ğŸ“š</span>
                <h1>èªå½™å­¦ç¿’ãƒ¢ãƒ¼ãƒ‰</h1>
            </div>
            <a href="../index.html" class="home-btn">ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</a>
        </div>

        <div class="content-area">
            <!-- ãƒ¬ãƒ™ãƒ«é¸æŠ -->
            <div id="levelSelect">
                <h2 style="margin-bottom: 1.5rem; text-align: center; color: #111827;">
                    å­¦ç¿’ãƒ¬ãƒ™ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„
                </h2>
                <div class="levels-grid" id="levelsGrid"></div>
            </div>

            <!-- å­¦ç¿’ãƒ¢ãƒ¼ãƒ‰é¸æŠ -->
            <div id="modeSelect" style="display: none;">
                <div id="selectedLevelInfo" style="text-align: center; margin-bottom: 1rem; padding: 1rem; background: linear-gradient(135deg, #fce7f3 0%, #fbcfe8 100%); border-radius: 0.75rem;">
                    <div style="font-size: 0.9rem; color: #9f1239; font-weight: 600; margin-bottom: 0.25rem;">é¸æŠä¸­ã®ãƒ¬ãƒ™ãƒ«</div>
                    <div id="currentLevelDisplay" style="font-size: 1.5rem; font-weight: 700; color: #831843;"></div>
                    <div id="currentWordCount" style="font-size: 0.95rem; color: #9f1239; margin-top: 0.25rem;"></div>
                </div>
                <h2 style="margin-bottom: 1.5rem; text-align: center; color: #111827;">
                    å­¦ç¿’æ–¹æ³•ã‚’é¸æŠã—ã¦ãã ã•ã„
                </h2>
                <div class="controls">
                    <button class="btn btn-primary" onclick="startFlashcard()">ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚«ãƒ¼ãƒ‰</button>
                    <button class="btn btn-primary" onclick="startQuiz()">ã‚¯ã‚¤ã‚ºå½¢å¼</button>
                    <button class="btn btn-secondary" onclick="backToLevelSelect()">ãƒ¬ãƒ™ãƒ«é¸æŠã«æˆ»ã‚‹</button>
                </div>
            </div>

            <!-- ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚«ãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ‰ -->
            <div id="flashcardMode" style="display: none;">
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
                    </div>
                    <div class="progress-text" id="progressText">0 / 0</div>
                </div>

                <div class="flashcard-container">
                    <div class="flashcard" id="flashcard" onclick="flipCard()">
                        <div class="card-face card-front" id="cardFront"></div>
                        <div class="card-face card-back" id="cardBack"></div>
                    </div>
                </div>

                <div class="controls">
                    <button class="btn btn-secondary" onclick="previousCard()">â¬… å‰ã¸</button>
                    <button class="btn btn-primary" onclick="flipCard()">ã‚«ãƒ¼ãƒ‰ã‚’ã‚ãã‚‹</button>
                    <button class="btn btn-secondary" onclick="nextCard()">æ¬¡ã¸ â¡</button>
                </div>
                <div class="controls">
                    <button class="btn btn-secondary" onclick="backToModeSelect()">ãƒ¢ãƒ¼ãƒ‰é¸æŠã«æˆ»ã‚‹</button>
                </div>
                <div style="text-align: center; margin-top: 1rem; padding: 1rem; background: #f3f4f6; border-radius: 0.5rem; color: #6b7280; font-size: 0.9rem;">
                    âŒ¨ï¸ <strong>ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ:</strong>
                    <span style="margin: 0 0.5rem;">ã‚¹ãƒšãƒ¼ã‚¹/Enter: ã‚ãã‚‹</span>
                    <span style="margin: 0 0.5rem;">â† / P: å‰ã¸</span>
                    <span style="margin: 0 0.5rem;">â†’ / N: æ¬¡ã¸</span>
                    <span style="margin: 0 0.5rem;">R: éŸ³å£°å†ç”Ÿ</span>
                </div>
            </div>

            <!-- ã‚¯ã‚¤ã‚ºãƒ¢ãƒ¼ãƒ‰ -->
            <div id="quizMode" style="display: none;">
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="quizProgressFill" style="width: 0%"></div>
                    </div>
                    <div class="progress-text" id="quizProgressText">0 / 0</div>
                </div>

                <div class="quiz-container">
                    <div class="quiz-question">
                        <div class="quiz-word" id="quizWord"></div>
                        <p style="color: #6b7280; margin-top: 1rem;">æ­£ã—ã„æ„å‘³ã‚’é¸ã‚“ã§ãã ã•ã„</p>
                    </div>
                    <div class="quiz-options" id="quizOptions"></div>
                </div>

                <div class="controls">
                    <button class="btn btn-secondary" onclick="backToModeSelect()">ãƒ¢ãƒ¼ãƒ‰é¸æŠã«æˆ»ã‚‹</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let vocabularyData = [];
        let currentLevel = null;
        let currentWords = [];
        let currentIndex = 0;
        let quizScore = 0;
        let speechSynthesis = window.speechSynthesis;
        let koreaVoice = null;

        async function init() {
            console.log('åˆæœŸåŒ–é–‹å§‹');

            await loadVocabularyData();
            console.log('ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å®Œäº†');

            renderLevelSelect();
            initSpeech();

            // åˆæœŸçŠ¶æ…‹: ãƒ¬ãƒ™ãƒ«é¸æŠç”»é¢ã®ã¿è¡¨ç¤º
            hideAllScreens();
            document.getElementById('levelSelect').style.display = 'block';

            console.log('åˆæœŸåŒ–å®Œäº†');
        }

        // éŸ³å£°åˆæˆã®åˆæœŸåŒ–
        function initSpeech() {
            if ('speechSynthesis' in window) {
                // éŸ“å›½èªéŸ³å£°ã‚’æ¢ã™
                const loadVoices = () => {
                    const voices = speechSynthesis.getVoices();
                    koreaVoice = voices.find(voice => voice.lang.startsWith('ko')) || voices[0];
                };

                loadVoices();
                if (speechSynthesis.onvoiceschanged !== undefined) {
                    speechSynthesis.onvoiceschanged = loadVoices;
                }
            }
        }

        // éŸ“å›½èªã‚’èª­ã¿ä¸Šã’ã‚‹ï¼ˆæœ€é©åŒ–ç‰ˆï¼‰
        function speakKorean(text) {
            if (!speechSynthesis) return;

            // æ—¢å­˜ã®éŸ³å£°ã‚’åœæ­¢
            speechSynthesis.cancel();

            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'ko-KR';
            utterance.rate = 0.9; // è‡ªç„¶ãªé€Ÿåº¦
            utterance.pitch = 1.0;
            utterance.volume = 1.0;

            if (koreaVoice) {
                utterance.voice = koreaVoice;
            }

            // ãƒ–ãƒ©ã‚¦ã‚¶ã®åˆ¶é™ã‚’å›é¿ã™ã‚‹ãŸã‚ã€ã™ãã«å†ç”Ÿã‚’é–‹å§‹
            // Chromeã‚„Safariã§ã¯åˆå›ã«é…å»¶ãŒç™ºç”Ÿã™ã‚‹ã“ã¨ãŒã‚ã‚‹ãŒã€
            // 2å›ç›®ä»¥é™ã¯å³åº§ã«å†ç”Ÿã•ã‚Œã‚‹
            requestAnimationFrame(() => {
                speechSynthesis.speak(utterance);
            });
        }

        async function loadVocabularyData() {
            try {
                const response = await fetch('../data/vocabulary/vocabulary-data.json');
                vocabularyData = await response.json();
            } catch (error) {
                console.error('èªå½™ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                vocabularyData = getDemoVocabulary();
            }
        }

        function getDemoVocabulary() {
            return {
                beginner: [
                    { korean: "ì•ˆë…•í•˜ì„¸ìš”", reading: "ã‚¢ãƒ³ãƒ‹ãƒ§ãƒ³ãƒã‚»ãƒ¨", meaning: "ã“ã‚“ã«ã¡ã¯", type: "æŒ¨æ‹¶", example: "ì•ˆë…•í•˜ì„¸ìš”, ë§Œë‚˜ì„œ ë°˜ê°‘ìŠµë‹ˆë‹¤", exampleTranslation: "ã“ã‚“ã«ã¡ã¯ã€ãŠä¼šã„ã§ãã¦å¬‰ã—ã„ã§ã™" },
                    { korean: "ê°ì‚¬í•©ë‹ˆë‹¤", reading: "ã‚«ãƒ ã‚µãƒãƒ ãƒ‹ãƒ€", meaning: "ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™", type: "æŒ¨æ‹¶", example: "ë„ì™€ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤", exampleTranslation: "åŠ©ã‘ã¦ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™" },
                    { korean: "ì‚¬ë‘", reading: "ã‚µãƒ©ãƒ³", meaning: "æ„›", type: "åè©", example: "ì‚¬ë‘ì´ í•„ìš”í•´ìš”", exampleTranslation: "æ„›ãŒå¿…è¦ã§ã™" },
                    { korean: "í•™ìƒ", reading: "ãƒã‚¯ã‚»ãƒ³", meaning: "å­¦ç”Ÿ", type: "åè©", example: "ì €ëŠ” ëŒ€í•™ìƒì…ë‹ˆë‹¤", exampleTranslation: "ç§ã¯å¤§å­¦ç”Ÿã§ã™" },
                    { korean: "ì¹œêµ¬", reading: "ãƒãƒ³ã‚°", meaning: "å‹é”", type: "åè©", example: "ì¹œêµ¬ë¥¼ ë§Œë‚˜ìš”", exampleTranslation: "å‹é”ã«ä¼šã„ã¾ã™" }
                ],
                intermediate: [
                    { korean: "í–‰ë³µ", reading: "ãƒ˜ãƒ³ãƒœã‚¯", meaning: "å¹¸ã›", type: "åè©", example: "í–‰ë³µí•œ í•˜ë£¨ ë³´ë‚´ì„¸ìš”", exampleTranslation: "å¹¸ã›ãªä¸€æ—¥ã‚’ãŠéã”ã—ãã ã•ã„" },
                    { korean: "ë…¸ë ¥", reading: "ãƒãƒªãƒ§ã‚¯", meaning: "åŠªåŠ›", type: "åè©", example: "ë…¸ë ¥í•˜ë©´ ì„±ê³µí•  ìˆ˜ ìˆì–´ìš”", exampleTranslation: "åŠªåŠ›ã™ã‚Œã°æˆåŠŸã§ãã¾ã™" },
                    { korean: "ì—¬í–‰", reading: "ãƒ¨ãƒ˜ãƒ³", meaning: "æ—…è¡Œ", type: "åè©", example: "í•œêµ­ ì—¬í–‰ì„ ê°”ì–´ìš”", exampleTranslation: "éŸ“å›½æ—…è¡Œã«è¡Œãã¾ã—ãŸ" },
                    { korean: "íšŒì‚¬", reading: "ãƒ•ã‚§ã‚µ", meaning: "ä¼šç¤¾", type: "åè©", example: "íšŒì‚¬ì—ì„œ ì¼í•´ìš”", exampleTranslation: "ä¼šç¤¾ã§åƒã„ã¦ã„ã¾ã™" },
                    { korean: "ìŒì‹", reading: "ã‚¦ãƒ ã‚·ã‚¯", meaning: "é£Ÿã¹ç‰©", type: "åè©", example: "í•œêµ­ ìŒì‹ì„ ì¢‹ì•„í•´ìš”", exampleTranslation: "éŸ“å›½æ–™ç†ãŒå¥½ãã§ã™" }
                ],
                advanced: [
                    { korean: "ì„±ì·¨ê°", reading: "ã‚½ãƒ³ãƒãƒ¥ã‚£ã‚¬ãƒ ", meaning: "é”æˆæ„Ÿ", type: "åè©", example: "í° ì„±ì·¨ê°ì„ ëŠê¼ˆì–´ìš”", exampleTranslation: "å¤§ããªé”æˆæ„Ÿã‚’æ„Ÿã˜ã¾ã—ãŸ" },
                    { korean: "ì¸ë‚´ì‹¬", reading: "ã‚¤ãƒ³ãƒã‚·ãƒ ", meaning: "å¿è€åŠ›", type: "åè©", example: "ì¸ë‚´ì‹¬ì´ í•„ìš”í•©ë‹ˆë‹¤", exampleTranslation: "å¿è€åŠ›ãŒå¿…è¦ã§ã™" },
                    { korean: "ë°œì „", reading: "ãƒ‘ãƒ«ã‚¸ãƒ§ãƒ³", meaning: "ç™ºå±•", type: "åè©", example: "ê²½ì œê°€ ë°œì „í•˜ê³  ìˆì–´ìš”", exampleTranslation: "çµŒæ¸ˆãŒç™ºå±•ã—ã¦ã„ã¾ã™" },
                    { korean: "í˜‘ë ¥", reading: "ãƒ’ãƒ§ãƒ—ãƒªãƒ§ã‚¯", meaning: "å”åŠ›", type: "åè©", example: "íŒ€ì›Œí¬ì™€ í˜‘ë ¥ì´ ì¤‘ìš”í•´ìš”", exampleTranslation: "ãƒãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¨å”åŠ›ãŒé‡è¦ã§ã™" },
                    { korean: "ì°½ì˜ì„±", reading: "ãƒãƒ£ãƒ³ã‚¦ã‚£ã‚½ãƒ³", meaning: "å‰µé€ æ€§", type: "åè©", example: "ì°½ì˜ì„±ì„ ë°œíœ˜í•˜ì„¸ìš”", exampleTranslation: "å‰µé€ æ€§ã‚’ç™ºæ®ã—ã¦ãã ã•ã„" }
                ]
            };
        }

        function renderLevelSelect() {
            const grid = document.getElementById('levelsGrid');

            const levels = [
                { key: 'beginner', title: 'åˆç´š', desc: 'åŸºç¤å˜èª' },
                { key: 'intermediate', title: 'ä¸­ç´š', desc: 'æ—¥å¸¸å˜èª' },
                { key: 'advanced', title: 'ä¸Šç´š', desc: 'é«˜ç´šå˜èª' }
            ];

            grid.innerHTML = levels.map(level => {
                const wordCount = vocabularyData[level.key]?.length || 0;
                const isSelected = currentLevel === level.key;
                return `
                    <div class="level-card ${isSelected ? 'active' : ''}" onclick="selectLevel('${level.key}')">
                        <div class="level-title">${level.title}</div>
                        <div class="level-desc">${level.desc} ${wordCount}èª</div>
                    </div>
                `;
            }).join('');
        }

        // çŠ¶æ…‹ã‚’å®Œå…¨ã«ãƒªã‚»ãƒƒãƒˆ
        function resetState() {
            currentIndex = 0;
            quizScore = 0;
            speechSynthesis.cancel(); // éŸ³å£°åœæ­¢

            // ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚«ãƒ¼ãƒ‰ã‚’ãƒªã‚»ãƒƒãƒˆ
            const flashcard = document.getElementById('flashcard');
            if (flashcard) {
                flashcard.classList.remove('flipped');
            }
        }

        // ã™ã¹ã¦ã®ç”»é¢ã‚’éè¡¨ç¤º
        function hideAllScreens() {
            document.getElementById('levelSelect').style.display = 'none';
            document.getElementById('modeSelect').style.display = 'none';
            document.getElementById('flashcardMode').style.display = 'none';
            document.getElementById('quizMode').style.display = 'none';
        }

        function selectLevel(level) {
            console.log('ãƒ¬ãƒ™ãƒ«é¸æŠ:', level);

            // çŠ¶æ…‹ã‚’å®Œå…¨ã«ãƒªã‚»ãƒƒãƒˆ
            resetState();

            // æ–°ã—ã„ãƒ¬ãƒ™ãƒ«ã‚’è¨­å®š
            currentLevel = level;
            currentWords = vocabularyData[level] || [];

            // ãƒ‡ãƒ¼ã‚¿ãŒæ­£ã—ããƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸã‹ç¢ºèª
            if (currentWords.length === 0) {
                console.error('å˜èªãƒ‡ãƒ¼ã‚¿ãŒç©ºã§ã™ã€‚ãƒ¬ãƒ™ãƒ«:', level);
                alert('å˜èªãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
                return;
            }

            console.log('èª­ã¿è¾¼ã¾ã‚ŒãŸå˜èªæ•°:', currentWords.length);
            console.log('æœ€åˆã®å˜èª:', currentWords[0]);

            // é¸æŠã•ã‚ŒãŸãƒ¬ãƒ™ãƒ«æƒ…å ±ã‚’æ›´æ–°
            const levelNames = {
                'beginner': 'åˆç´š',
                'intermediate': 'ä¸­ç´š',
                'advanced': 'ä¸Šç´š'
            };

            document.getElementById('currentLevelDisplay').textContent = levelNames[level] || level;
            document.getElementById('currentWordCount').textContent = `${currentWords.length}å€‹ã®å˜èª`;

            // ç”»é¢é·ç§»
            hideAllScreens();
            document.getElementById('modeSelect').style.display = 'block';
        }

        function backToLevelSelect() {
            console.log('ãƒ¬ãƒ™ãƒ«é¸æŠã«æˆ»ã‚‹');

            resetState();
            currentLevel = null;
            currentWords = [];

            hideAllScreens();
            document.getElementById('levelSelect').style.display = 'block';

            // ãƒ¬ãƒ™ãƒ«é¸æŠç”»é¢ã‚’å†ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ï¼ˆé¸æŠçŠ¶æ…‹ã‚’ã‚¯ãƒªã‚¢ï¼‰
            renderLevelSelect();
        }

        function startFlashcard() {
            // ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã™ã‚‹ã‹å†ç¢ºèª
            if (!currentLevel || currentWords.length === 0) {
                console.error('ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ãƒ¬ãƒ™ãƒ«:', currentLevel);
                alert('å…ˆã«ãƒ¬ãƒ™ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
                backToLevelSelect();
                return;
            }

            console.log('ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚«ãƒ¼ãƒ‰é–‹å§‹ã€‚å˜èªæ•°:', currentWords.length);

            resetState();

            hideAllScreens();
            document.getElementById('flashcardMode').style.display = 'block';

            // æœ€åˆã®ã‚«ãƒ¼ãƒ‰ã‚’è¡¨ç¤º
            showCard();
        }

        function startQuiz() {
            // ãƒ‡ãƒ¼ã‚¿ãŒå­˜åœ¨ã™ã‚‹ã‹å†ç¢ºèª
            if (!currentLevel || currentWords.length === 0) {
                console.error('ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ãƒ¬ãƒ™ãƒ«:', currentLevel);
                alert('å…ˆã«ãƒ¬ãƒ™ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
                backToLevelSelect();
                return;
            }

            // ã‚¯ã‚¤ã‚ºã«ã¯æœ€ä½4ã¤ã®å˜èªãŒå¿…è¦
            if (currentWords.length < 4) {
                alert('ã‚¯ã‚¤ã‚ºã«ã¯æœ€ä½4ã¤ã®å˜èªãŒå¿…è¦ã§ã™ã€‚');
                return;
            }

            console.log('ã‚¯ã‚¤ã‚ºé–‹å§‹ã€‚å˜èªæ•°:', currentWords.length);

            resetState();

            hideAllScreens();
            document.getElementById('quizMode').style.display = 'block';

            showQuiz();
        }

        function backToModeSelect() {
            // ãƒ‡ãƒ¼ã‚¿ãŒå¤±ã‚ã‚Œã¦ã„ã‚‹å ´åˆã¯ãƒ¬ãƒ™ãƒ«é¸æŠã«æˆ»ã‚‹
            if (!currentLevel || currentWords.length === 0) {
                console.warn('ãƒ‡ãƒ¼ã‚¿ãŒå¤±ã‚ã‚Œã¦ã„ã¾ã™ã€‚ãƒ¬ãƒ™ãƒ«é¸æŠã«æˆ»ã‚Šã¾ã™ã€‚');
                backToLevelSelect();
                return;
            }

            resetState();

            hideAllScreens();
            document.getElementById('modeSelect').style.display = 'block';
        }

        function showCard() {
            // å®‰å…¨æ€§ãƒã‚§ãƒƒã‚¯
            if (!currentWords || currentWords.length === 0) {
                console.error('showCard: å˜èªãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“');
                return;
            }

            if (currentIndex < 0 || currentIndex >= currentWords.length) {
                console.error('showCard: ç„¡åŠ¹ãªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹', currentIndex);
                currentIndex = 0;
            }

            const word = currentWords[currentIndex];

            if (!word) {
                console.error('showCard: å˜èªãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹:', currentIndex);
                return;
            }

            console.log('ã‚«ãƒ¼ãƒ‰è¡¨ç¤º:', currentIndex + 1, '/', currentWords.length, '-', word.korean);

            document.getElementById('cardFront').innerHTML = `
                <button class="audio-btn" onclick="event.stopPropagation(); replayAudio('front')" title="éŸ³å£°ã‚’å†ç”Ÿ">ğŸ”Š</button>
                <div class="korean-word">${word.korean}</div>
                <div class="reading">${word.reading}</div>
                <div class="word-type">${word.type}</div>
            `;

            document.getElementById('cardBack').innerHTML = `
                <button class="audio-btn" onclick="event.stopPropagation(); replayAudio('back')" title="ä¾‹æ–‡ã‚’å†ç”Ÿ">ğŸ”Š</button>
                <div class="meaning">${word.meaning}</div>
                <div class="example">${word.example}</div>
                <div class="example-translation">${word.exampleTranslation}</div>
            `;

            updateProgress();
            document.getElementById('flashcard').classList.remove('flipped');

            // ã‚«ãƒ¼ãƒ‰ãŒè¡¨ç¤ºã•ã‚ŒãŸã‚‰å³åº§ã«éŸ³å£°å†ç”Ÿ
            speakKorean(word.korean);
        }

        // éŸ³å£°ã‚’å†ç”Ÿ
        function replayAudio(side) {
            if (currentWords.length === 0) return;
            const word = currentWords[currentIndex];

            if (side === 'front') {
                speakKorean(word.korean);
            } else {
                speakKorean(word.example);
            }
        }

        function flipCard() {
            const flashcard = document.getElementById('flashcard');
            const isFlipped = flashcard.classList.toggle('flipped');

            // ã‚«ãƒ¼ãƒ‰ãŒè£è¿”ã•ã‚ŒãŸã‚‰ä¾‹æ–‡ã‚’å³åº§ã«èª­ã¿ä¸Šã’
            if (isFlipped && currentWords.length > 0) {
                const word = currentWords[currentIndex];
                // CSS transitionãŒå§‹ã¾ã£ãŸå¾Œã«å†ç”Ÿ
                requestAnimationFrame(() => {
                    speakKorean(word.example);
                });
            }
        }

        function nextCard() {
            currentIndex = (currentIndex + 1) % currentWords.length;
            showCard();
        }

        function previousCard() {
            currentIndex = (currentIndex - 1 + currentWords.length) % currentWords.length;
            showCard();
        }

        function updateProgress() {
            const progress = ((currentIndex + 1) / currentWords.length) * 100;
            document.getElementById('progressFill').style.width = `${progress}%`;
            document.getElementById('progressText').textContent = `${currentIndex + 1} / ${currentWords.length}`;
        }

        function showQuiz() {
            // å®‰å…¨æ€§ãƒã‚§ãƒƒã‚¯
            if (!currentWords || currentWords.length === 0) {
                console.error('showQuiz: å˜èªãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“');
                backToLevelSelect();
                return;
            }

            if (currentIndex < 0 || currentIndex >= currentWords.length) {
                console.error('showQuiz: ç„¡åŠ¹ãªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹', currentIndex);
                currentIndex = 0;
            }

            const word = currentWords[currentIndex];

            if (!word) {
                console.error('showQuiz: å˜èªãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                return;
            }

            console.log('ã‚¯ã‚¤ã‚ºè¡¨ç¤º:', currentIndex + 1, '/', currentWords.length, '-', word.korean);

            document.getElementById('quizWord').textContent = word.korean;

            const correctAnswer = word.meaning;
            const wrongAnswers = currentWords
                .filter(w => w.meaning !== correctAnswer)
                .sort(() => Math.random() - 0.5)
                .slice(0, 3)
                .map(w => w.meaning);

            const allOptions = [correctAnswer, ...wrongAnswers].sort(() => Math.random() - 0.5);

            const optionsContainer = document.getElementById('quizOptions');
            optionsContainer.innerHTML = allOptions.map(option => `
                <div class="quiz-option" onclick="selectAnswer('${option}', '${correctAnswer}')">
                    ${option}
                </div>
            `).join('');

            const progress = ((currentIndex + 1) / currentWords.length) * 100;
            document.getElementById('quizProgressFill').style.width = `${progress}%`;
            document.getElementById('quizProgressText').textContent = `${currentIndex + 1} / ${currentWords.length}`;
        }

        function selectAnswer(selected, correct) {
            const options = document.querySelectorAll('.quiz-option');
            options.forEach(option => {
                option.style.pointerEvents = 'none';
                if (option.textContent.trim() === correct) {
                    option.classList.add('correct');
                } else if (option.textContent.trim() === selected) {
                    option.classList.add('incorrect');
                }
            });

            if (selected === correct) {
                quizScore++;
            }

            setTimeout(() => {
                currentIndex++;
                if (currentIndex < currentWords.length) {
                    showQuiz();
                } else {
                    alert(`ã‚¯ã‚¤ã‚ºå®Œäº†ï¼ã‚¹ã‚³ã‚¢: ${quizScore} / ${currentWords.length}`);
                    backToModeSelect();
                }
            }, 1500);
        }

        // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
        document.addEventListener('keydown', (e) => {
            // ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã‚«ãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹å ´åˆã®ã¿
            const flashcardMode = document.getElementById('flashcardMode');
            if (flashcardMode.style.display === 'none') return;

            switch(e.key) {
                case ' ':  // ã‚¹ãƒšãƒ¼ã‚¹ã‚­ãƒ¼
                case 'Enter':  // ã‚¨ãƒ³ã‚¿ãƒ¼ã‚­ãƒ¼
                    e.preventDefault();
                    flipCard();
                    break;
                case 'ArrowRight':  // å³çŸ¢å°
                case 'n':  // Nã‚­ãƒ¼ï¼ˆNextï¼‰
                    e.preventDefault();
                    nextCard();
                    break;
                case 'ArrowLeft':  // å·¦çŸ¢å°
                case 'p':  // Pã‚­ãƒ¼ï¼ˆPreviousï¼‰
                    e.preventDefault();
                    previousCard();
                    break;
                case 'r':  // Rã‚­ãƒ¼ï¼ˆReplayï¼‰
                    e.preventDefault();
                    if (currentWords.length > 0) {
                        const word = currentWords[currentIndex];
                        const isFlipped = document.getElementById('flashcard').classList.contains('flipped');
                        speakKorean(isFlipped ? word.example : word.korean);
                    }
                    break;
            }
        });

        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
